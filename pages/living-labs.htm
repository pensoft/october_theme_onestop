url = "/living-labs"
layout = "default"
title = "Living Labs"
is_hidden = 0
meta_description = "living labs page"
seo_keywords = "keywords"
robot_index = "index"
robot_follow = "follow"

[jumbotron living-labs-intro]
jumbotron = "living-labs-intro"
templates = "template2" 
description_limit = 0

[jumbotron living-labs-outro]
jumbotron = "living-labs-outro"
templates = "template2" 
description_limit = 0

[siteSearchInclude]
==
<?php
use Pensoft\Partners\Models\Partners as Partner;
function onStart(){
    $this['living_labs'] = Partner::where('type', 2)->get();
    
    // Prepare partner data for JavaScript
    $partnersData = [];
    foreach ($this['living_labs'] as $partner) {
        $countryCodes = is_array($partner->country_code) ? $partner->country_code : (json_decode($partner->country_code, true) ?: []);
        foreach ($countryCodes as $countryCode) {
            if (!isset($partnersData[$countryCode])) {
                $partnersData[$countryCode] = [];
            }
            $partnersData[$countryCode][] = [
                'institution' => $partner->instituion,
                'logo' => $partner->cover ? $partner->cover->getThumb(100, 60, 'auto') : null,
                'url' => $partner->instituion_url
            ];
        }
    }
    $this['partnersData'] = $partnersData;
}
?>
==
{% component 'siteSearchInclude' %}

<script>
// Make partner data available to JavaScript
window.livingLabsPartners = {{ partnersData|json_encode|raw }};
</script>

<div class="container-fluid living-labs-page">
    <div class="container">
        {% component 'living-labs-intro' %}
    </div>

    <div class="container map">
        {% partial 'components/living-labs-map' %}
    </div>

    <div class="container">
        {% component 'living-labs-outro' %}
    </div>
</div>

